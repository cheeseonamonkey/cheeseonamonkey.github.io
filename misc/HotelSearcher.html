<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Price Finder</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Rubik', sans-serif;
            max-width: 650px;
            margin: 0 auto;
            padding: 15px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        
        h1 {
            margin: 0 0 15px 0;
            font-size: 20px;
            font-weight: 600;
            color: #222;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }
        
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            margin-top: 5px;
            transition: 0.15s;
        }
        
        button:hover { background: #0056b3; }
        button:active { background: #004494; transform: scale(0.98); }
        
        .preset-btn {
            background: #6c757d;
            padding: 6px 12px;
            font-size: 12px;
            margin: 0 4px 0 0;
        }
        
        .preset-btn:hover { background: #545b62; }
        
        .results {
            margin-top: 20px;
            display: none;
        }
        
        .results.show { display: block; }
        
        .results h2 {
            font-size: 15px;
            font-weight: 600;
            margin: 0 0 10px 0;
        }
        
        .link-item {
            margin-bottom: 8px;
            padding: 10px;
            background: #fafafa;
            border-radius: 3px;
            border-left: 3px solid #007bff;
            transition: all 0.15s;
            cursor: pointer;
        }
        
        .link-item:hover {
            background: #f0f5ff;
            border-left-color: #0056b3;
        }
        
        .link-item.visited {
            background: #f0f0f0;
            border-left-color: #999;
            opacity: 0.7;
        }
        
        .link-item a {
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            display: block;
        }
        
        .link-item a:visited { color: #999; }
        .link-item a:hover { text-decoration: underline; }
        
        .note {
            font-size: 11px;
            color: #888;
            margin-top: 3px;
        }
        
        .link-item.visited .note { color: #aaa; }
        
        @media (max-width: 500px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            input { font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hotel Price Finder</h1>
        
        <div class="form-group">
            <label>Location</label>
            <input type="text" id="location" value="Midvale, UT" oninput="generateLinks()">
        </div>
        
        <div class="form-row">
            <div>
                <label>Arrival</label>
                <input type="date" id="checkin" onchange="updateNights(); generateLinks()">
            </div>
            <div>
                <label>Departure <span id="nights" style="color: #999;"></span></label>
                <input type="date" id="checkout" onchange="updateNights(); generateLinks()">
            </div>
        </div>
        
        <div style="margin-bottom: 8px;">
            <button onclick="setDates(1, 1)" class="preset-btn">1 night</button>
            <button onclick="setDates(1, 2)" class="preset-btn">2 nights</button>
            <button onclick="setDates(1, 3)" class="preset-btn">3 nights</button>
            <button onclick="setDates(1, 7)" class="preset-btn">7 nights</button>
        </div>
        
        <div class="form-row">
            <div>
                <label>Adults</label>
                <input type="number" id="adults" value="1" min="1" onchange="generateLinks()">
            </div>
            <div>
                <label>Children</label>
                <input type="number" id="children" value="1" min="0" onchange="generateLinks()">
            </div>
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
            <label>Child Age(s)</label>
            <input type="text" id="childAge" value="4" placeholder="e.g., 4 or 4,7,10" oninput="generateLinks()">
        </div>
        
        <div id="results" class="results">
            <h2>Search Links</h2>
            <div id="linksList"></div>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        
        function getParams() {
            const p = new URLSearchParams(location.search);
            return {
                location: p.get('location') || 'Midvale, UT',
                checkin: p.get('checkin'),
                checkout: p.get('checkout'),
                adults: p.get('adults') || '1',
                children: p.get('children') || '1',
                childAge: p.get('childAge') || '4'
            };
        }
        
        function setDates(daysFromNow, nights) {
            const checkin = new Date();
            checkin.setDate(checkin.getDate() + daysFromNow);
            const checkout = new Date(checkin);
            checkout.setDate(checkin.getDate() + nights);
            
            $('checkin').value = checkin.toISOString().split('T')[0];
            $('checkout').value = checkout.toISOString().split('T')[0];
            
            updateNights();
            generateLinks();
        }
        
        function initDates() {
            const params = getParams();
            $('location').value = params.location;
            $('adults').value = params.adults;
            $('children').value = params.children;
            $('childAge').value = params.childAge;
            
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const checkin = params.checkin || tomorrow.toISOString().split('T')[0];
            
            const afterTomorrow = new Date(tomorrow);
            afterTomorrow.setDate(tomorrow.getDate() + 2);
            const checkout = params.checkout || afterTomorrow.toISOString().split('T')[0];
            
            $('checkin').value = checkin;
            $('checkout').value = checkout;
            $('checkin').min = today;
            $('checkout').min = today;
        }
        
        function updateNights() {
            const nights = Math.round((new Date($('checkout').value) - new Date($('checkin').value)) / 86400000);
            $('nights').textContent = nights > 0 ? `(${nights} night${nights !== 1 ? 's' : ''})` : '';
        }
        
        function markVisited(url) {
            const visited = JSON.parse(localStorage.getItem('hotelVisited') || '[]');
            if (!visited.includes(url)) {
                visited.push(url);
                localStorage.setItem('hotelVisited', JSON.stringify(visited));
            }
            updateCardStates();
        }
        
        function updateCardStates() {
            const visited = JSON.parse(localStorage.getItem('hotelVisited') || '[]');
            document.querySelectorAll('.link-item').forEach(item => {
                const url = item.querySelector('a').href;
                item.classList.toggle('visited', visited.includes(url));
            });
        }
        
        function generateLinks() {
            const loc = $('location').value;
            const cin = $('checkin').value;
            const cout = $('checkout').value;
            const adults = $('adults').value;
            const children = $('children').value;
            const childAges = $('childAge').value;
            
            const cinFmt = cin.replace(/-/g, '');
            const coutFmt = cout.replace(/-/g, '');
            const locEnc = encodeURIComponent(loc);
            const locPath = loc.replace(/,/g, '').replace(/\s+/g, ',');
            const firstAge = childAges.split(',')[0]?.trim() || '0';
            
            const links = [
                { name: 'Booking.com', url: `https://www.booking.com/searchresults.html?ss=${locEnc}&checkin=${cin}&checkout=${cout}&group_adults=${adults}&group_children=${children}&age=${firstAge}&order=price`, note: '✓ Sorted by price' },
                { name: 'KAYAK', url: `https://www.kayak.com/hotels/${locPath}/${cin}/${cout}/${adults}adults?sort=price_a`, note: '✓ Sorted by price' },
                { name: 'Priceline', url: `https://www.priceline.com/relax/in/${locPath}/from/${cinFmt}/to/${coutFmt}/rooms/1/adults/${adults}/children/${childAges}?sortby=PRICE`, note: '✓ Sorted by price' },
                { name: 'Hotwire', url: `https://www.hotwire.com/Hotel-Search?startDate=${cin}&endDate=${cout}&destination=${locEnc}&rooms=${adults}&sort=PRICE_LOW_TO_HIGH`, note: '✓ Sorted by price' },
                { name: 'CheapOair', url: `https://www.cheapoair.com/hotels/listing?location=${locEnc}&checkin=${cin}&checkout=${cout}&rooms=1&adults=${adults}`, note: 'Sort in UI' },
                { name: 'OneTravel', url: `https://www.onetravel.com/hotels?location=${locEnc}&checkin=${cin}&checkout=${cout}&rooms=1&adults=${adults}`, note: 'Sort in UI' },
                { name: 'HotelTonight', url: `https://www.hoteltonight.com/s/${locEnc}?checkInDate=${cin}&checkOutDate=${cout}`, note: 'Sort in UI' },
                { name: 'Google Travel', url: `https://www.google.com/travel/hotels/${locEnc}?checkin=${cin}&checkout=${cout}&adults=${adults}`, note: 'Sort in UI' },
                { name: 'Hotels.com', url: `https://www.hotels.com/Hotel-Search?destination=${locEnc}&startDate=${cin}&endDate=${cout}&adults=${adults}&rooms=1`, note: 'Sort in UI' },
                { name: 'Expedia', url: `https://www.expedia.com/Hotel-Search?destination=${locEnc}&startDate=${cin}&endDate=${cout}&rooms=1&adults=${adults}&sort=PRICE_LOW_TO_HIGH`, note: '✓ Sorted by price' }
            ];
            
            $('linksList').innerHTML = links.map(link => 
                `<div class="link-item"><a href="${link.url}" target="_blank" onclick="markVisited('${link.url}')">${link.name}</a><div class="note">${link.note}</div></div>`
            ).join('');
            
            updateCardStates();
            $('results').classList.add('show');
        }
        
        window.onload = () => {
            initDates();
            updateNights();
            generateLinks();
        };
    </script>
</body>
</html>
