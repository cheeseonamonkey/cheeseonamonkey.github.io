<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Price Finder</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Rubik', sans-serif; max-width: 650px; margin: 0 auto; padding: 15px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        h1 { margin: 0 0 15px 0; font-size: 20px; font-weight: 600; color: #222; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        label { display: block; margin-bottom: 4px; font-size: 13px; font-weight: 500; color: #555; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; font-family: inherit; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 10px 14px; border-radius: 3px; cursor: pointer; font-weight: 600; font-size: 14px; margin-top: 5px; transition: 0.15s; }
        button:hover { background: #0056b3; }
        button:active { background: #004494; transform: scale(0.98); }
        .preset-btn { background: #6c757d; padding: 6px 12px; font-size: 12px; margin: 0 4px 0 0; }
        .preset-btn:hover { background: #545b62; }
        .results { margin-top: 20px; }
        .results h2 { font-size: 15px; font-weight: 600; margin: 0 0 10px 0; }
        .link-item { margin-bottom: 8px; padding: 10px; background: #fafafa; border-radius: 3px; border-left: 3px solid #007bff; transition: all 0.15s; }
        .link-item:hover { background: #f0f5ff; border-left-color: #0056b3; }
        .link-item.visited { background: #f0f0f0; border-left-color: #999; opacity: 0.7; }
        .link-item a { color: #007bff; text-decoration: none; font-size: 14px; font-weight: 500; display: block; }
        .link-item a:visited { color: #999; }
        .link-item a:hover { text-decoration: underline; }
        .note { font-size: 11px; color: #888; margin-top: 3px; }
        @media (max-width: 500px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            input { font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hotel Price Finder</h1>
        
        <div class="form-group">
            <label>Location</label>
            <input type="text" id="location" oninput="update()">
        </div>
        
        <div class="form-row">
            <div>
                <label>Arrival</label>
                <input type="date" id="checkin" onchange="update()">
            </div>
            <div>
                <label>Departure <span id="nights"></span></label>
                <input type="date" id="checkout" onchange="update()">
            </div>
        </div>
        
        <div style="margin-bottom: 8px;">
            <button onclick="setDates(0, 1)" class="preset-btn">Tonight</button>
            <button onclick="setDates(0, 2)" class="preset-btn">2 nights</button>
            <button onclick="setDates(0, 3)" class="preset-btn">3 nights</button>
            <button onclick="setDates(0, 7)" class="preset-btn">7 nights</button>
        </div>
        
        <div class="form-row">
            <div>
                <label>Adults</label>
                <input type="number" id="adults" min="1" onchange="update()">
            </div>
            <div>
                <label>Children</label>
                <input type="number" id="children" min="0" onchange="update()">
            </div>
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
            <label>Child Age(s)</label>
            <input type="text" id="childAge" placeholder="e.g., 4 or 4,7,10" oninput="update()">
        </div>
        
        <div id="results" class="results">
            <h2>Search Links</h2>
            <div id="linksList"></div>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        
        function setDates(from, nights) {
            const cin = new Date();
            cin.setDate(cin.getDate() + from);
            const cout = new Date(cin);
            cout.setDate(cin.getDate() + nights);
            $('checkin').value = cin.toISOString().split('T')[0];
            $('checkout').value = cout.toISOString().split('T')[0];
            update();
        }
        
        function update() {
            const loc = $('location').value;
            const cin = $('checkin').value;
            const cout = $('checkout').value;
            const adults = $('adults').value;
            const children = $('children').value;
            const ages = $('childAge').value;
            
            const nights = Math.round((new Date(cout) - new Date(cin)) / 86400000);
            $('nights').textContent = nights > 0 ? `(${nights} night${nights !== 1 ? 's' : ''})` : '';
            
            location.hash = new URLSearchParams({location: loc, checkin: cin, checkout: cout, adults, children, childAge: ages});
            
            const enc = encodeURIComponent;
            const compact = cin.replace(/-/g, '');
            const compactOut = cout.replace(/-/g, '');
            const pathLoc = loc.replace(/,\s*/g, ',').replace(/\s+/g, ',');
            const age = ages.split(',')[0]?.trim() || '0';
            const ageParams = ages.split(',').filter(a => a.trim()).map(a => `age=${a.trim()}`).join('&') || 'age=0';
            
            const links = [
                { name: 'Booking.com', url: `https://www.booking.com/searchresults.html?ss=${enc(loc)}&checkin=${cin}&checkout=${cout}&group_adults=${adults}&group_children=${children}&${ageParams}&order=price`, note: '✓ Sorted by price' },
                { name: 'KAYAK', url: `https://www.kayak.com/hotels/${enc(pathLoc)}/${cin}/${cout}/${adults}adults?sort=price_a`, note: '✓ Sorted by price' },
                { name: 'Priceline', url: `https://www.priceline.com/relax/in/${enc(pathLoc)}/from/${compact}/to/${compactOut}/rooms/1/adults/${adults}/children/${ages || '0'}?sortby=PRICE`, note: '✓ Sorted by price' },
                { name: 'Expedia', url: `https://www.expedia.com/Hotel-Search?destination=${enc(loc)}&startDate=${cin}&endDate=${cout}&rooms=1&adults=${adults}`, note: 'Sort in UI' },
                { name: 'Hotels.com', url: `https://www.hotels.com/Hotel-Search?destination=${enc(loc)}&startDate=${cin}&endDate=${cout}&adults=${adults}&rooms=1`, note: 'Sort in UI' },
                { name: 'Google Travel', url: `https://www.google.com/travel/hotels/${enc(loc)}?checkin=${cin}&checkout=${cout}&adults=${adults}`, note: 'Sort in UI' }
            ];
            
            const visited = JSON.parse(localStorage.hotelVisited || '[]');
            $('linksList').innerHTML = links.map((l, i) => 
                `<div class="link-item ${visited.includes(l.name) ? 'visited' : ''}" data-idx="${i}">
                    <a href="${l.url}" target="_blank">${l.name}</a>
                    <div class="note">${l.note}</div>
                </div>`
            ).join('');
            
            document.querySelectorAll('.link-item').forEach(el => {
                el.querySelector('a').onclick = () => {
                    const name = links[el.dataset.idx].name;
                    const v = JSON.parse(localStorage.hotelVisited || '[]');
                    if (!v.includes(name)) localStorage.hotelVisited = JSON.stringify([...v, name]);
                    el.classList.add('visited');
                };
            });
        }
        
        const p = new URLSearchParams(location.hash.slice(1));
        $('location').value = p.get('location') || 'Midvale, UT';
        $('adults').value = p.get('adults') || '1';
        $('children').value = p.get('children') || '1';
        $('childAge').value = p.get('childAge') || '4';
        
        const today = new Date().toISOString().split('T')[0];
        const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
        $('checkin').value = p.get('checkin') || today;
        $('checkout').value = p.get('checkout') || tomorrow;
        $('checkin').min = $('checkout').min = today;
        
        update();
    </script>
</body>
</html>
