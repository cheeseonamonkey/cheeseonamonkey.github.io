<div id="GithubActivityWidget" style="width: 300px; height: 500px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px;">
  <table id="GithubActivityTable" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th></th>
        <th>Repo</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>

<script>
const user = new URLSearchParams(window.location.search).get('user')
if(!user){
  throw("GithubActivityWidget: no user provided")
}

fetch(`https://api.github.com/users/${user.toString()}/events/public?limit=59`)
    .then(response => response.json())
    .then(processGithubEvents);

function processGithubEvents(events) {
  const tableBody = document.querySelector('#GithubActivityTable tbody');
  events.forEach(event => {
    const row = createGithubEventElement(event);
    tableBody.appendChild(row);
  });
}

function createGithubEventElement(event) {

function getLengthAgo(dateOf) {
    let currentDate = new Date();
    let timeDifference = currentDate.getTime() - dateOf.getTime();
    let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
    let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    let weeks = Math.floor(days / 7);
    let months = Math.floor(days / 30);

    if(months > 0) {
        return `${months} months ago`;
    } else if(weeks > 0) {
        return `${weeks} weeks ago`;
    } else if(days > 0) {
        return `${days} days ago`;
    } else {
        return `${hours} hours ago`;
    }
}

  
const row = document.createElement('tr');

const createdAt = document.createElement('td');
let dateOf = new Date(event.created_at) ?? null;
createdAt.innerHTML = `<i>(${(getLengthAgo(dateOf) ?? "")})</i>`;
row.appendChild(createdAt);

const repo = document.createElement('td');
repo.innerHTML = `<a href="https://github.com/${event.repo.name}" target="_blank">${event.repo.name}</a>`;
row.appendChild(repo);

 

const description = document.createElement('td');
description.innerHTML = getDescription(event);
row.appendChild(description);

return row; 
}

function getDescription(event) {
switch (event.type) {
case 'PushEvent':
return `Pushed ${event.payload.commits.length} commit(s) to <a href="https://github.com/${event.repo.name}/tree/${event.payload.ref.replace('refs/heads/', '')}" target="_blank">${event.payload.ref.replace('refs/heads/', '')}</a> branch. Commit message(s): ${event.payload.commits.map(commit => `<a href="https://github.com/${event.repo.name}/commit/${commit.sha}" target="_blank">${commit.message}</a>`).join(', ')}.`;
case 'PullRequestEvent':
return `<a href="${event.payload.pull_request.html_url}" target="_blank">${event.payload.pull_request.title}</a> pull request was ${event.payload.action}.`;
case 'IssuesEvent':
return `<a href="${event.payload.issue.html_url}" target="_blank">${event.payload.issue.title}</a> issue was ${event.payload.action}.`;
case 'ForkEvent':
return `Forked the repository to <a href="${event.payload.forkee.html_url}" target="_blank">${event.payload.forkee.full_name}</a>.`;
case 'WatchEvent':
return `Started watching this repository.`;
default:
return 'Performed an unknown event.';
}
}
</script>
