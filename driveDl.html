<!DOCTYPE html>
<html>
<head>
  <title>Google Drive OAuth</title>
  <script>
    async function handleClientLoad() {
      await initClient();
    }

    async function initClient() {
      const response = await fetch('https://www.googleapis.com/discovery/v1/apis/drive/v3/rest');
      const discoveryDoc = await response.json();
      const clientId = '234538019368-9cj60k6jis23t2c2acsq39mghav8ncf7.apps.googleusercontent.com';
      const redirectUri = window.location.href;
      const scope = 'https://www.googleapis.com/auth/drive.readonly';

      gapi.auth2.init({
        client_id: clientId,
        redirect_uri: redirectUri,
        scope: scope,
        discoveryDocs: [discoveryDoc]
      }).then(function(auth2) {
        if (auth2.isSignedIn.get()) {
          showFiles();
        } else {
          handleRedirect();
        }
      });
    }

    function handleRedirect() {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('code')) {
        const code = urlParams.get('code');
        gapi.auth2.getAuthInstance().grantOfflineAccess({ 'code': code }).then(function(response) {
          // Handle the authorization code and exchange it for an access token
          // You can make an AJAX request to your server to exchange the code for an access token
          // and then redirect the user to the desired page
        });
      }
    }

    async function showFiles() {
      const response = await gapi.client.drive.files.list({
        'pageSize': 5,
        'fields': 'files(name)'
      });
      const files = response.result.files;
      const fileList = document.getElementById('fileList');
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const listItem = document.createElement('li');
        listItem.appendChild(document.createTextNode(file.name));
        fileList.appendChild(listItem);
      }
    }
  </script>
</head>
<body>
  <h1>Google Drive OAuth</h1>
  <ul id="fileList"></ul>
  <script src="https://apis.google.com/js/api.js?onload=handleClientLoad"></script>
</body>
</html>
