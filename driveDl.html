
<!DOCTYPE html>
<html>
<head>
  <title>Google Drive OAuth</title>
  <script>
    const clientId = '234538019368-9cj60k6jis23t2c2acsq39mghav8ncf7.apps.googleusercontent.com';
    const redirectUri = encodeURIComponent(window.location.href);
    const scope = encodeURIComponent('https://www.googleapis.com/auth/drive.readonly');
    const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}`;

    async function handleClientLoad() {
      const accessToken = getAccessTokenFromUrl();
      if (accessToken) {
        showFiles(accessToken);
      } else {
        document.body.innerHTML += 
        `<br>
        <a href="${authUrl}">Authenticate Google Drive</a>
        <br>`
      }
    }

    function getAccessTokenFromUrl() {
      const hash = window.location.hash.substr(1);
      const urlParams = new URLSearchParams(hash);
      return urlParams.get('access_token');
    }

async function showFolders(accessToken) {
  const response = await fetch('https://www.googleapis.com/drive/v3/files?q=mimeType=\'application/vnd.google-apps.folder\'&fields=files(id,name)', {
    headers: {
      'Authorization': `Bearer ${accessToken}`
    }
  });
  const data = await response.json();
  const folders = data.files;
  const folderList = document.getElementById('folderList');
  for (let i = 0; i < folders.length; i++) {
    const folder = folders[i];
    const listItem = document.createElement('li');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = folder.id;
    checkbox.onchange = function() {
      if (this.checked) {
        showFiles(accessToken, folder.id, i);
      } else {
        removeFiles(i);
      }
    }
    listItem.appendChild(checkbox);
    listItem.appendChild(document.createTextNode(folder.name));
    folderList.appendChild(listItem);
  }
}

async function showFiles(accessToken, folderId, row) {
  const response = await fetch(`https://www.googleapis.com/drive/v3/files?q=\'${folderId}\' in parents&orderBy=modifiedTime desc&pageSize=5&fields=files(id,name,modifiedTime)`, {
    headers: {
      'Authorization': `Bearer ${accessToken}`
    }
  });
  const data = await response.json();
  const files = data.files;
  const fileList = document.getElementById('fileList');
  const folderFiles = document.createElement('ul');
  folderFiles.id = `folderFiles${row}`;
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const listItem = document.createElement('li');
    listItem.appendChild(document.createTextNode(file.name));
    folderFiles.appendChild(listItem);
  }
  fileList.appendChild(folderFiles);
}

function removeFiles(row) {
  const folderFiles = document.getElementById(`folderFiles${row}`);
  folderFiles.parentNode.removeChild(folderFiles);
}




    window.onload = handleClientLoad;
  </script>
</head>
<body>
  <h1>Google Drive OAuth</h1>
  <ul id="fileList"></ul>
</body>
</html>
