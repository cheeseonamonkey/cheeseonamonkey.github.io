<!DOCTYPE html>
<html>

<head>
   <meta name="viewport" content="width=500, initial-scale=1.0, maximum-scale=2.0, minimum-scale=0.5, user-scalable=no">
   <title>Chess Games</title>
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <style>
      body {
         font-family: Arial, sans-serif;
         background-color: #f2f2f2;
         margin: 0;
         padding: 20px;
      }

      h1 {
         color: #333;
         text-align: center;
      }

      #gamesContainer {
         background-color: #fff;
         padding: 20px;
         border: 1px solid #ccc;
         border-radius: 5px;
      }

      h3 {
         margin: 0;
         font-size: 18px;
         margin-bottom: 10px;
      }

      a {
         color: #333;
         text-decoration: none;
      }

      p {
         margin: 0;
         margin-bottom: 10px;
      }

      pre {
         background-color: #f9f9f9;
         padding: 10px;
         border: 1px solid #ccc;
         border-radius: 5px;
         white-space: pre-wrap;
         font-size: 14px;
         line-height: 1.5;
         overflow: auto;
      }
   </style>
</head>

<body>
   <h1>Chess Games</h1>
   <div id="gamesContainer"></div>

   <script>
      const proxyUrl = 'https://cors-anywhere.herokuapp.com/';

      // Retrieve the username from the URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const username = urlParams.get('username');

      // Call the getGames function with the username
      getGames(username);

      async function getGames(username) {
         var apiUrl = proxyUrl + 'https://api.chess.com/pub/player/' + username + '/games/archives';

         $.getJSON(apiUrl, function (data) {
            var archives = data.archives;
            var games = [];

            archives.forEach(async function (archiveUrl) {
               await $.getJSON(proxyUrl + archiveUrl, function (archiveData) {
                  games = games.concat(archiveData.games);
                  displayGames(games);
               });
            });
         });
      }

      function displayGames(games) {
         var gamesContainer = $('#gamesContainer');
         gamesContainer.empty();

         games.forEach(function (game) {
            var gameUrl = game.url;
            var pgn = game.pgn;
            var result = game.white.result === 'win' ? 'White won' : 'Black won';

            var gameHtml = '<div>';
            gameHtml += '<h3>Game: <a href="' + gameUrl + '">' + gameUrl + '</a></h3>';
            gameHtml += '<p>Result: ' + result + '</p>';
            gameHtml += '<pre>' + pgn + '</pre>';
            gameHtml += '</div>';

            gamesContainer.append(gameHtml);
         });
      }
   </script>
</body>

</html>
